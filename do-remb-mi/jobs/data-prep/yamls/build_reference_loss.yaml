run_name: pile-subsets-build
platform: r1z1
gpu_type: a100_80gb
gpu_num: 8
image: mosaicml/pytorch:1.13.1_cu117-python3.10-ubuntu20.04
integrations:
  - integration_type: git_repo
    git_repo: zankner/llm-foundry
    git_branch: zack/do-remb-mi
    # git_commit: # OR use your commit hash
    pip_install: -e .[gpu]
    ssh_clone: false # Should be true if using a private repo
  - integration_type: pip_packages
    packages:
      - oci-cli
command: |
  pip install oci-cli
  cd llm-foundry
  composer -n 2 do-remb-mi/scripts/data/build_reference_loss.py --batch-size 512 --num-domains 22 --ref-model-size 125M --ref-model-ckpt oci://mosaicml-internal-checkpoints/zack/DoReMi/pile/reference/ref-125M-param-step-100K-seed-17/ep0-ba100000/rank0.pt
  oci os object bulk-upload -bn mosaicml-internal-doremi --src-dir /tmp/domains --prefix pile/token-ref-loss/gpt-neox-20b-seqlen-2048/data-sources/ > /dev/null
